(ns blaze.elm.compiler.library-test-perf
  (:require
   [blaze.cql.translator :as t]
   [blaze.db.api-stub :refer [mem-node-config]]
   [blaze.elm.compiler.library :as library]
   [blaze.elm.compiler.library-spec]
   [blaze.fhir.spec.type.system]
   [blaze.module.test-util :refer [with-system]]
   [blaze.terminology-service :as ts]
   [blaze.terminology-service.local]
   [clojure.test :refer [deftest]]
   [criterium.core :as criterium]
   [integrant.core :as ig]
   [taoensso.timbre :as log]))

(log/set-min-level! :info)

(def config
  (assoc
   mem-node-config
   ::ts/local
   {:node (ig/ref :blaze.db/node)
    :clock (ig/ref :blaze.test/fixed-clock)}))

(deftest compile-test
  (let [library (t/translate "library \"antidiabetika\"\nusing FHIR version '4.0.0'\ninclude FHIRHelpers version '4.0.0'\n\ncodesystem atc: 'http://fhir.de/CodeSystem/bfarm/atc'\n\ncontext Unfiltered\n\ndefine GliclazidA10BB09Ref:\n  from [Medication: Code 'A10BB09' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin degludec und Insulin aspartA10AD06Ref\":\n  from [Medication: Code 'A10AD06' from atc] M\n    return 'Medication/' + M.id\n\ndefine SulfonylharnstoffeA10BBRef:\n  from [Medication: Code 'A10BB' from atc] M\n    return 'Medication/' + M.id\n\ndefine TolbutamidA10BB03Ref:\n  from [Medication: Code 'A10BB03' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insuline und Analoga zur Injektion, intermediär oder lang wirkend kombiniert mit schnell wirkendA10ADRef\":\n  from [Medication: Code 'A10AD' from atc] M\n    return 'Medication/' + M.id\n\ndefine LiraglutidA10BJ02Ref:\n  from [Medication: Code 'A10BJ02' from atc] M\n    return 'Medication/' + M.id\n\ndefine EvogliptinA10BH07Ref:\n  from [Medication: Code 'A10BH07' from atc] M\n    return 'Medication/' + M.id\n\ndefine GlibornuridA10BB04Ref:\n  from [Medication: Code 'A10BB04' from atc] M\n    return 'Medication/' + M.id\n\ndefine ErtugliflozinA10BK04Ref:\n  from [Medication: Code 'A10BK04' from atc] M\n    return 'Medication/' + M.id\n\ndefine KombinationenA10AE30Ref:\n  from [Medication: Code 'A10AE30' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und SulfonylharnstoffeA10BD02Ref\":\n  from [Medication: Code 'A10BD02' from atc] M\n    return 'Medication/' + M.id\n\ndefine AcetohexamidA10BB31Ref:\n  from [Medication: Code 'A10BB31' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und AcarboseA10BD17Ref\":\n  from [Medication: Code 'A10BD17' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Glimepirid und RosiglitazonA10BD04Ref\":\n  from [Medication: Code 'A10BD04' from atc] M\n    return 'Medication/' + M.id\n\ndefine ChlorpropamidA10BB02Ref:\n  from [Medication: Code 'A10BB02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insuline und Analoga zur Injektion, schnell wirkendA10ABRef\":\n  from [Medication: Code 'A10AB' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (human)A10AC01Ref\":\n  from [Medication: Code 'A10AC01' from atc] M\n    return 'Medication/' + M.id\n\ndefine VogliboseA10BF03Ref:\n  from [Medication: Code 'A10BF03' from atc] M\n    return 'Medication/' + M.id\n\ndefine GlimepiridA10BB12Ref:\n  from [Medication: Code 'A10BB12' from atc] M\n    return 'Medication/' + M.id\n\ndefine DapagliflozinA10BK01Ref:\n  from [Medication: Code 'A10BK01' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und DapagliflozinA10BD15Ref\":\n  from [Medication: Code 'A10BD15' from atc] M\n    return 'Medication/' + M.id\n\ndefine KombinationenA10AB30Ref:\n  from [Medication: Code 'A10AB30' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin degludec und LiraglutidA10AE56Ref\":\n  from [Medication: Code 'A10AE56' from atc] M\n    return 'Medication/' + M.id\n\ndefine CanagliflozinA10BK02Ref:\n  from [Medication: Code 'A10BK02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und AlogliptinA10BD13Ref\":\n  from [Medication: Code 'A10BD13' from atc] M\n    return 'Medication/' + M.id\n\ndefine ExenatidA10BJ01Ref:\n  from [Medication: Code 'A10BJ01' from atc] M\n    return 'Medication/' + M.id\n\ndefine GliquidonA10BB08Ref:\n  from [Medication: Code 'A10BB08' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin glargin und LixisenatidA10AE54Ref\":\n  from [Medication: Code 'A10AE54' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin detemirA10AE05Ref\":\n  from [Medication: Code 'A10AE05' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin, Saxagliptin und DapagliflozinA10BD25Ref\":\n  from [Medication: Code 'A10BD25' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Rind)A10AB02Ref\":\n  from [Medication: Code 'A10AB02' from atc] M\n    return 'Medication/' + M.id\n\ndefine VildagliptinA10BH02Ref:\n  from [Medication: Code 'A10BH02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Phenformin und SulfonylharnstoffeA10BD01Ref\":\n  from [Medication: Code 'A10BD01' from atc] M\n    return 'Medication/' + M.id\n\ndefine KombinationenA10AC30Ref:\n  from [Medication: Code 'A10AC30' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und ErtugliflozinA10BD23Ref\":\n  from [Medication: Code 'A10BD23' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und SaxagliptinA10BD10Ref\":\n  from [Medication: Code 'A10BD10' from atc] M\n    return 'Medication/' + M.id\n\ndefine SaxagliptinA10BH03Ref:\n  from [Medication: Code 'A10BH03' from atc] M\n    return 'Medication/' + M.id\n\ndefine LinagliptinA10BH05Ref:\n  from [Medication: Code 'A10BH05' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Guar-Mehl*A10BX01Ref\":\n  from [Medication: Code 'A10BX01' from atc] M\n    return 'Medication/' + M.id\n\ndefine RosiglitazonA10BG02Ref:\n  from [Medication: Code 'A10BG02' from atc] M\n    return 'Medication/' + M.id\n\ndefine GlisoxepidA10BB11Ref:\n  from [Medication: Code 'A10BB11' from atc] M\n    return 'Medication/' + M.id\n\ndefine GlibenclamidA10BB01Ref:\n  from [Medication: Code 'A10BB01' from atc] M\n    return 'Medication/' + M.id\n\ndefine TeneligliptinA10BH08Ref:\n  from [Medication: Code 'A10BH08' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin glulisinA10AB06Ref\":\n  from [Medication: Code 'A10AB06' from atc] M\n    return 'Medication/' + M.id\n\ndefine AldosereduktasehemmerA10XARef:\n  from [Medication: Code 'A10XA' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin aspartA10AB05Ref\":\n  from [Medication: Code 'A10AB05' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin glarginA10AE04Ref\":\n  from [Medication: Code 'A10AE04' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insuline Und AnalogaA10ARef\":\n  from [Medication: Code 'A10A' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Schwein)A10AE03Ref\":\n  from [Medication: Code 'A10AE03' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (human)A10AB01Ref\":\n  from [Medication: Code 'A10AB01' from atc] M\n    return 'Medication/' + M.id\n\ndefine MetforminA10BA02Ref:\n  from [Medication: Code 'A10BA02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Sulfonamide (heterozyklisch)A10BCRef\":\n  from [Medication: Code 'A10BC' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Pioglitazon und SitagliptinA10BD12Ref\":\n  from [Medication: Code 'A10BD12' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Homöopathische und anthroposophische AntidiabetikaA10XHRef\":\n  from [Medication: Code 'A10XH' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und EvogliptinA10BD22Ref\":\n  from [Medication: Code 'A10BD22' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (human)A10AE01Ref\":\n  from [Medication: Code 'A10AE01' from atc] M\n    return 'Medication/' + M.id\n\ndefine SitagliptinA10BH01Ref:\n  from [Medication: Code 'A10BH01' from atc] M\n    return 'Medication/' + M.id\n\ndefine CopalchirindenextraktA10XP02Ref:\n  from [Medication: Code 'A10XP02' from atc] M\n    return 'Medication/' + M.id\n\ndefine ImegliminA10BX15Ref:\n  from [Medication: Code 'A10BX15' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und GemigliptinA10BD18Ref\":\n  from [Medication: Code 'A10BD18' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Dipeptidyl-Peptidase-4-(DPP-4)-InhibitorenA10BHRef\":\n  from [Medication: Code 'A10BH' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin lisproA10AC04Ref\":\n  from [Medication: Code 'A10AC04' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und EmpagliflozinA10BD20Ref\":\n  from [Medication: Code 'A10BD20' from atc] M\n    return 'Medication/' + M.id\n\ndefine GlipizidA10BB07Ref:\n  from [Medication: Code 'A10BB07' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Sitagliptin und SimvastatinA10BH51Ref\":\n  from [Medication: Code 'A10BH51' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und RosiglitazonA10BD03Ref\":\n  from [Medication: Code 'A10BD03' from atc] M\n    return 'Medication/' + M.id\n\ndefine PhenforminA10BA01Ref:\n  from [Medication: Code 'A10BA01' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Gemigliptin und RosuvastatinA10BH52Ref\":\n  from [Medication: Code 'A10BH52' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Rind)A10AD02Ref\":\n  from [Medication: Code 'A10AD02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Schwein)A10AC03Ref\":\n  from [Medication: Code 'A10AC03' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insuline und Analoga zur InhalationA10AFRef\":\n  from [Medication: Code 'A10AF' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Linagliptin und EmpagliflozinA10BD19Ref\":\n  from [Medication: Code 'A10BD19' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insuline und Analoga zur Injektion, lang wirkendA10AERef\":\n  from [Medication: Code 'A10AE' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und GlibenclamidA10BD31Ref\":\n  from [Medication: Code 'A10BD31' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Sitagliptin und ErtugliflozinA10BD24Ref\":\n  from [Medication: Code 'A10BD24' from atc] M\n    return 'Medication/' + M.id\n\ndefine BenfluorexA10BX06Ref:\n  from [Medication: Code 'A10BX06' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und VildagliptinA10BD08Ref\":\n  from [Medication: Code 'A10BD08' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Glucagon-like-Peptid-1-(GLP-1)-RezeptoragonistenA10BJRef\":\n  from [Medication: Code 'A10BJ' from atc] M\n    return 'Medication/' + M.id\n\ndefine TroglitazonA10BG01Ref:\n  from [Medication: Code 'A10BG01' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin aspartA10AD05Ref\":\n  from [Medication: Code 'A10AD05' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Andere AntidiabetikaA10XRef\":\n  from [Medication: Code 'A10X' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (human)A10AD01Ref\":\n  from [Medication: Code 'A10AD01' from atc] M\n    return 'Medication/' + M.id\n\ndefine AntidiabetikaA10Ref:\n  from [Medication: Code 'A10' from atc] M\n    return 'Medication/' + M.id\n\ndefine EmpagliflozinA10BK03Ref:\n  from [Medication: Code 'A10BK03' from atc] M\n    return 'Medication/' + M.id\n\ndefine PioglitazonA10BG03Ref:\n  from [Medication: Code 'A10BG03' from atc] M\n    return 'Medication/' + M.id\n\ndefine CarbutamidA10BB06Ref:\n  from [Medication: Code 'A10BB06' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin lisproA10AB04Ref\":\n  from [Medication: Code 'A10AB04' from atc] M\n    return 'Medication/' + M.id\n\ndefine MiglitolA10BF02Ref:\n  from [Medication: Code 'A10BF02' from atc] M\n    return 'Medication/' + M.id\n\ndefine RepaglinidA10BX02Ref:\n  from [Medication: Code 'A10BX02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und SitagliptinA10BD07Ref\":\n  from [Medication: Code 'A10BD07' from atc] M\n    return 'Medication/' + M.id\n\ndefine GemigliptinA10BH06Ref:\n  from [Medication: Code 'A10BH06' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Rind)A10AC02Ref\":\n  from [Medication: Code 'A10AC02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und RepaglinidA10BD14Ref\":\n  from [Medication: Code 'A10BD14' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Schwein)A10AB03Ref\":\n  from [Medication: Code 'A10AB03' from atc] M\n    return 'Medication/' + M.id\n\ndefine KombinationenA10AD30Ref:\n  from [Medication: Code 'A10AD30' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und CanagliflozinA10BD16Ref\":\n  from [Medication: Code 'A10BD16' from atc] M\n    return 'Medication/' + M.id\n\ndefine SemaglutidA10BJ06Ref:\n  from [Medication: Code 'A10BJ06' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Thiazolidindione (Glitazone)A10BGRef\":\n  from [Medication: Code 'A10BG' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Kombinationen oraler AntidiabetikaA10BDRef\":\n  from [Medication: Code 'A10BD' from atc] M\n    return 'Medication/' + M.id\n\ndefine IpragliflozinA10BK05Ref:\n  from [Medication: Code 'A10BK05' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Guar-MehlA10XP01Ref\":\n  from [Medication: Code 'A10XP01' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Pioglitazon und AlogliptinA10BD09Ref\":\n  from [Medication: Code 'A10BD09' from atc] M\n    return 'Medication/' + M.id\n\ndefine AcarboseA10BF01Ref:\n  from [Medication: Code 'A10BF01' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Saxagliptin und DapagliflozinA10BD21Ref\":\n  from [Medication: Code 'A10BD21' from atc] M\n    return 'Medication/' + M.id\n\ndefine AlbiglutidA10BJ04Ref:\n  from [Medication: Code 'A10BJ04' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Pflanzliche AntidiabetikaA10XPRef\":\n  from [Medication: Code 'A10XP' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insuline und Analoga zur Injektion, intermediär wirkendA10ACRef\":\n  from [Medication: Code 'A10AC' from atc] M\n    return 'Medication/' + M.id\n\ndefine TolazamidA10BB05Ref:\n  from [Medication: Code 'A10BB05' from atc] M\n    return 'Medication/' + M.id\n\ndefine SotagliflozinA10BK06Ref:\n  from [Medication: Code 'A10BK06' from atc] M\n    return 'Medication/' + M.id\n\ndefine TolrestatA10XA01Ref:\n  from [Medication: Code 'A10XA01' from atc] M\n    return 'Medication/' + M.id\n\ndefine BuforminA10BA03Ref:\n  from [Medication: Code 'A10BA03' from atc] M\n    return 'Medication/' + M.id\n\ndefine BiguanideA10BARef:\n  from [Medication: Code 'A10BA' from atc] M\n    return 'Medication/' + M.id\n\ndefine LuseogliflozinA10BK07Ref:\n  from [Medication: Code 'A10BK07' from atc] M\n    return 'Medication/' + M.id\n\ndefine AlogliptinA10BH04Ref:\n  from [Medication: Code 'A10BH04' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (human)A10AF01Ref\":\n  from [Medication: Code 'A10AF01' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und PioglitazonA10BD05Ref\":\n  from [Medication: Code 'A10BD05' from atc] M\n    return 'Medication/' + M.id\n\ndefine MitiglinidA10BX08Ref:\n  from [Medication: Code 'A10BX08' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin degludecA10AE06Ref\":\n  from [Medication: Code 'A10AE06' from atc] M\n    return 'Medication/' + M.id\n\ndefine BeinaglutidA10BJ07Ref:\n  from [Medication: Code 'A10BJ07' from atc] M\n    return 'Medication/' + M.id\n\ndefine LobeglitazonA10BG04Ref:\n  from [Medication: Code 'A10BG04' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und LobeglitazonA10BD26Ref\":\n  from [Medication: Code 'A10BD26' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin lisproA10AD04Ref\":\n  from [Medication: Code 'A10AD04' from atc] M\n    return 'Medication/' + M.id\n\ndefine DulaglutidA10BJ05Ref:\n  from [Medication: Code 'A10BJ05' from atc] M\n    return 'Medication/' + M.id\n\ndefine KombinationenA10XP30Ref:\n  from [Medication: Code 'A10XP30' from atc] M\n    return 'Medication/' + M.id\n\ndefine NateglinidA10BX03Ref:\n  from [Medication: Code 'A10BX03' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Rind)A10AE02Ref\":\n  from [Medication: Code 'A10AE02' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Insulin (Schwein)A10AD03Ref\":\n  from [Medication: Code 'A10AD03' from atc] M\n    return 'Medication/' + M.id\n\ndefine PramlintidA10BX05Ref:\n  from [Medication: Code 'A10BX05' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Natrium-Glucose-Cotransporter-2-(SGLT2)-InhibitorenA10BKRef\":\n  from [Medication: Code 'A10BK' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Antidiabetika, Exkl. InsulineA10BRef\":\n  from [Medication: Code 'A10B' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin, Linagliptin und EmpagliflozinA10BD27Ref\":\n  from [Medication: Code 'A10BD27' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Andere Antidiabetika, exkl. InsulineA10BXRef\":\n  from [Medication: Code 'A10BX' from atc] M\n    return 'Medication/' + M.id\n\ndefine KombinationenA10XH20Ref:\n  from [Medication: Code 'A10XH20' from atc] M\n    return 'Medication/' + M.id\n\ndefine MetahexamidA10BB10Ref:\n  from [Medication: Code 'A10BB10' from atc] M\n    return 'Medication/' + M.id\n\ndefine GlymidinA10BC01Ref:\n  from [Medication: Code 'A10BC01' from atc] M\n    return 'Medication/' + M.id\n\ndefine LixisenatidA10BJ03Ref:\n  from [Medication: Code 'A10BJ03' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Glimepirid und PioglitazonA10BD06Ref\":\n  from [Medication: Code 'A10BD06' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Alpha-GlukosidasehemmerA10BFRef\":\n  from [Medication: Code 'A10BF' from atc] M\n    return 'Medication/' + M.id\n\ndefine \"Metformin und LinagliptinA10BD11Ref\":\n  from [Medication: Code 'A10BD11' from atc] M\n    return 'Medication/' + M.id\n\ncontext Patient\n\ndefine InInitialPopulation:\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in AntidiabetikaA10Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Antidiabetika, Exkl. InsulineA10BRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Alpha-GlukosidasehemmerA10BFRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in AcarboseA10BF01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in MiglitolA10BF02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in VogliboseA10BF03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in BiguanideA10BARef) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in BuforminA10BA03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in MetforminA10BA02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in PhenforminA10BA01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Dipeptidyl-Peptidase-4-(DPP-4)-InhibitorenA10BHRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in AlogliptinA10BH04Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in EvogliptinA10BH07Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GemigliptinA10BH06Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Gemigliptin und RosuvastatinA10BH52Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in LinagliptinA10BH05Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in SaxagliptinA10BH03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in SitagliptinA10BH01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Sitagliptin und SimvastatinA10BH51Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in TeneligliptinA10BH08Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in VildagliptinA10BH02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Glucagon-like-Peptid-1-(GLP-1)-RezeptoragonistenA10BJRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in AlbiglutidA10BJ04Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in BeinaglutidA10BJ07Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in DulaglutidA10BJ05Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in ExenatidA10BJ01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in LiraglutidA10BJ02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in LixisenatidA10BJ03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in SemaglutidA10BJ06Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Kombinationen oraler AntidiabetikaA10BDRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Glimepirid und PioglitazonA10BD06Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Glimepirid und RosiglitazonA10BD04Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Linagliptin und EmpagliflozinA10BD19Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und AcarboseA10BD17Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und AlogliptinA10BD13Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und CanagliflozinA10BD16Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und DapagliflozinA10BD15Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und EmpagliflozinA10BD20Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und ErtugliflozinA10BD23Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und EvogliptinA10BD22Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und GemigliptinA10BD18Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und GlibenclamidA10BD31Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und LinagliptinA10BD11Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und LobeglitazonA10BD26Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und PioglitazonA10BD05Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und RepaglinidA10BD14Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und RosiglitazonA10BD03Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und SaxagliptinA10BD10Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und SitagliptinA10BD07Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und SulfonylharnstoffeA10BD02Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin und VildagliptinA10BD08Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin, Linagliptin und EmpagliflozinA10BD27Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Metformin, Saxagliptin und DapagliflozinA10BD25Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Phenformin und SulfonylharnstoffeA10BD01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Pioglitazon und AlogliptinA10BD09Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Pioglitazon und SitagliptinA10BD12Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Saxagliptin und DapagliflozinA10BD21Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Sitagliptin und ErtugliflozinA10BD24Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Natrium-Glucose-Cotransporter-2-(SGLT2)-InhibitorenA10BKRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in CanagliflozinA10BK02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in DapagliflozinA10BK01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in EmpagliflozinA10BK03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in ErtugliflozinA10BK04Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in IpragliflozinA10BK05Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in LuseogliflozinA10BK07Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in SotagliflozinA10BK06Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Sulfonamide (heterozyklisch)A10BCRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GlymidinA10BC01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in SulfonylharnstoffeA10BBRef) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in AcetohexamidA10BB31Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in CarbutamidA10BB06Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in ChlorpropamidA10BB02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GlibenclamidA10BB01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GlibornuridA10BB04Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GliclazidA10BB09Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GlimepiridA10BB12Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GlipizidA10BB07Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GliquidonA10BB08Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in GlisoxepidA10BB11Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in MetahexamidA10BB10Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in TolazamidA10BB05Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in TolbutamidA10BB03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Thiazolidindione (Glitazone)A10BGRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in LobeglitazonA10BG04Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in PioglitazonA10BG03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in RosiglitazonA10BG02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in TroglitazonA10BG01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Andere Antidiabetika, exkl. InsulineA10BXRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in BenfluorexA10BX06Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Guar-Mehl*A10BX01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in ImegliminA10BX15Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in MitiglinidA10BX08Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in NateglinidA10BX03Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in PramlintidA10BX05Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in RepaglinidA10BX02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insuline Und AnalogaA10ARef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insuline und Analoga zur InhalationA10AFRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (human)A10AF01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insuline und Analoga zur Injektion, intermediär oder lang wirkend kombiniert mit schnell wirkendA10ADRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (human)A10AD01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Rind)A10AD02Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Schwein)A10AD03Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin aspartA10AD05Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin degludec und Insulin aspartA10AD06Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin lisproA10AD04Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in KombinationenA10AD30Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insuline und Analoga zur Injektion, intermediär wirkendA10ACRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (human)A10AC01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Rind)A10AC02Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Schwein)A10AC03Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin lisproA10AC04Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in KombinationenA10AC30Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insuline und Analoga zur Injektion, lang wirkendA10AERef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (human)A10AE01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Rind)A10AE02Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Schwein)A10AE03Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin degludecA10AE06Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin degludec und LiraglutidA10AE56Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin detemirA10AE05Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin glarginA10AE04Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin glargin und LixisenatidA10AE54Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in KombinationenA10AE30Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insuline und Analoga zur Injektion, schnell wirkendA10ABRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (human)A10AB01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Rind)A10AB02Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin (Schwein)A10AB03Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin aspartA10AB05Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin glulisinA10AB06Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Insulin lisproA10AB04Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in KombinationenA10AB30Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Andere AntidiabetikaA10XRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in AldosereduktasehemmerA10XARef) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in TolrestatA10XA01Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Homöopathische und anthroposophische AntidiabetikaA10XHRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in KombinationenA10XH20Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Pflanzliche AntidiabetikaA10XPRef\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in CopalchirindenextraktA10XP02Ref) or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in \"Guar-MehlA10XP01Ref\") or\n  exists (from [MedicationAdministration] M\n    where M.medication.reference in KombinationenA10XP30Ref)\n")]
    (with-system [{:blaze.db/keys [node] ::ts/keys [local]} config]
      ;; 1.7 ms / 15 µs - Macbook Pro M1 Pro, Oracle OpenJDK 17.0.2
      (criterium/quick-bench (library/compile-library {:node node :terminology-service local} library {})))))
